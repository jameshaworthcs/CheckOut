<!DOCTYPE html>
<html lang="en">

<head>
  <!--====== Required meta tags ======-->
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <style>.select2-container{box-sizing:border-box;display:inline-block;margin:0;position:relative;vertical-align:middle}.select2-container .select2-selection--single{box-sizing:border-box;cursor:pointer;display:block;height:28px;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--single .select2-selection__rendered{display:block;padding-left:8px;padding-right:20px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.select2-container .select2-selection--single .select2-selection__clear{position:relative}.select2-container[dir="rtl"] .select2-selection--single .select2-selection__rendered{padding-right:8px;padding-left:20px}.select2-container .select2-selection--multiple{box-sizing:border-box;cursor:pointer;display:block;min-height:32px;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--multiple .select2-selection__rendered{display:inline-block;overflow:hidden;padding-left:8px;text-overflow:ellipsis;white-space:nowrap}.select2-container .select2-search--inline{float:left}.select2-container .select2-search--inline .select2-search__field{box-sizing:border-box;border:none;font-size:100%;margin-top:5px;padding:0}.select2-container .select2-search--inline .select2-search__field::-webkit-search-cancel-button{-webkit-appearance:none}.select2-dropdown{background-color:white;border:1px solid #aaa;border-radius:4px;box-sizing:border-box;display:block;position:absolute;left:-100000px;width:100%;z-index:1051}.select2-results{display:block}.select2-results__options{list-style:none;margin:0;padding:0}.select2-results__option{padding:6px;user-select:none;-webkit-user-select:none}.select2-results__option[aria-selected]{cursor:pointer}.select2-container--open .select2-dropdown{left:0}.select2-container--open .select2-dropdown--above{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--open .select2-dropdown--below{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-search--dropdown{display:block;padding:4px}.select2-search--dropdown .select2-search__field{padding:4px;width:100%;box-sizing:border-box}.select2-search--dropdown .select2-search__field::-webkit-search-cancel-button{-webkit-appearance:none}.select2-search--dropdown.select2-search--hide{display:none}.select2-close-mask{border:0;margin:0;padding:0;display:block;position:fixed;left:0;top:0;min-height:100%;min-width:100%;height:auto;width:auto;opacity:0;z-index:99;background-color:#fff;filter:alpha(opacity=0)}.select2-hidden-accessible{border:0 !important;clip:rect(0 0 0 0) !important;-webkit-clip-path:inset(50%) !important;clip-path:inset(50%) !important;height:1px !important;overflow:hidden !important;padding:0 !important;position:absolute !important;width:1px !important;white-space:nowrap !important}.select2-container--default .select2-selection--single{background-color:#fff;border:1px solid #aaa;border-radius:4px}.select2-container--default .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--default .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:bold}.select2-container--default .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--default .select2-selection--single .select2-selection__arrow{height:26px;position:absolute;top:1px;right:1px;width:20px}.select2-container--default .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__clear{float:left}.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__arrow{left:1px;right:auto}.select2-container--default.select2-container--disabled .select2-selection--single{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection--single .select2-selection__clear{display:none}.select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888 transparent;border-width:0 4px 5px 4px}.select2-container--default .select2-selection--multiple{background-color:white;border:1px solid #aaa;border-radius:4px;cursor:text}.select2-container--default .select2-selection--multiple .select2-selection__rendered{box-sizing:border-box;list-style:none;margin:0;padding:0 5px;width:100%}.select2-container--default .select2-selection--multiple .select2-selection__rendered li{list-style:none}.select2-container--default .select2-selection--multiple .select2-selection__clear{cursor:pointer;float:right;font-weight:bold;margin-top:5px;margin-right:10px;padding:1px}.select2-container--default .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;cursor:default;float:left;margin-right:5px;margin-top:5px;padding:0 5px}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove{color:#999;cursor:pointer;display:inline-block;font-weight:bold;margin-right:2px}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover{color:#333}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice,.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-search--inline{float:right}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove{margin-left:2px;margin-right:auto}.select2-container--default.select2-container--focus .select2-selection--multiple{border:solid black 1px;outline:0}.select2-container--default.select2-container--disabled .select2-selection--multiple{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection__choice__remove{display:none}.select2-container--default.select2-container--open.select2-container--above .select2-selection--single,.select2-container--default.select2-container--open.select2-container--above .select2-selection--multiple{border-top-left-radius:0;border-top-right-radius:0}.select2-container--default.select2-container--open.select2-container--below .select2-selection--single,.select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple{border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--default .select2-search--dropdown .select2-search__field{border:1px solid #aaa}.select2-container--default .select2-search--inline .select2-search__field{background:transparent;border:none;outline:0;box-shadow:none;-webkit-appearance:textfield}.select2-container--default .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--default .select2-results__option[role=group]{padding:0}.select2-container--default .select2-results__option[aria-disabled=true]{color:#999}.select2-container--default .select2-results__option[aria-selected=true]{background-color:#ddd}.select2-container--default .select2-results__option .select2-results__option{padding-left:1em}.select2-container--default .select2-results__option .select2-results__option .select2-results__group{padding-left:0}.select2-container--default .select2-results__option .select2-results__option .select2-results__option{margin-left:-1em;padding-left:2em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-2em;padding-left:3em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-3em;padding-left:4em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-4em;padding-left:5em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-5em;padding-left:6em}.select2-container--default .select2-results__option--highlighted[aria-selected]{background-color:#5897fb;color:white}.select2-container--default .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic .select2-selection--single{background-color:#f7f7f7;border:1px solid #aaa;border-radius:4px;outline:0;background-image:-webkit-linear-gradient(top, #fff 50%, #eee 100%);background-image:-o-linear-gradient(top, #fff 50%, #eee 100%);background-image:linear-gradient(to bottom, #fff 50%, #eee 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)}.select2-container--classic .select2-selection--single:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--classic .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:bold;margin-right:10px}.select2-container--classic .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--classic .select2-selection--single .select2-selection__arrow{background-color:#ddd;border:none;border-left:1px solid #aaa;border-top-right-radius:4px;border-bottom-right-radius:4px;height:26px;position:absolute;top:1px;right:1px;width:20px;background-image:-webkit-linear-gradient(top, #eee 50%, #ccc 100%);background-image:-o-linear-gradient(top, #eee 50%, #ccc 100%);background-image:linear-gradient(to bottom, #eee 50%, #ccc 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFCCCCCC', GradientType=0)}.select2-container--classic .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__clear{float:left}.select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__arrow{border:none;border-right:1px solid #aaa;border-radius:0;border-top-left-radius:4px;border-bottom-left-radius:4px;left:1px;right:auto}.select2-container--classic.select2-container--open .select2-selection--single{border:1px solid #5897fb}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow{background:transparent;border:none}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888 transparent;border-width:0 4px 5px 4px}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--single{border-top:none;border-top-left-radius:0;border-top-right-radius:0;background-image:-webkit-linear-gradient(top, #fff 0%, #eee 50%);background-image:-o-linear-gradient(top, #fff 0%, #eee 50%);background-image:linear-gradient(to bottom, #fff 0%, #eee 50%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--single{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0;background-image:-webkit-linear-gradient(top, #eee 50%, #fff 100%);background-image:-o-linear-gradient(top, #eee 50%, #fff 100%);background-image:linear-gradient(to bottom, #eee 50%, #fff 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFFFFFFF', GradientType=0)}.select2-container--classic .select2-selection--multiple{background-color:white;border:1px solid #aaa;border-radius:4px;cursor:text;outline:0}.select2-container--classic .select2-selection--multiple:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--multiple .select2-selection__rendered{list-style:none;margin:0;padding:0 5px}.select2-container--classic .select2-selection--multiple .select2-selection__clear{display:none}.select2-container--classic .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;cursor:default;float:left;margin-right:5px;margin-top:5px;padding:0 5px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove{color:#888;cursor:pointer;display:inline-block;font-weight:bold;margin-right:2px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove:hover{color:#555}.select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice{float:right;margin-left:5px;margin-right:auto}.select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove{margin-left:2px;margin-right:auto}.select2-container--classic.select2-container--open .select2-selection--multiple{border:1px solid #5897fb}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--multiple{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--multiple{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--classic .select2-search--dropdown .select2-search__field{border:1px solid #aaa;outline:0}.select2-container--classic .select2-search--inline .select2-search__field{outline:0;box-shadow:none}.select2-container--classic .select2-dropdown{background-color:#fff;border:1px solid transparent}.select2-container--classic .select2-dropdown--above{border-bottom:none}.select2-container--classic .select2-dropdown--below{border-top:none}.select2-container--classic .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--classic .select2-results__option[role=group]{padding:0}.select2-container--classic .select2-results__option[aria-disabled=true]{color:grey}.select2-container--classic .select2-results__option--highlighted[aria-selected]{background-color:#3875d7;color:#fff}.select2-container--classic .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic.select2-container--open .select2-dropdown{border-color:#5897fb}</style>
  <script defer data-domain="rejectdopamine.com" src="https://t.ldn.jemedia.xyz/js/script.js"></script>
  <link rel="shortcut icon" href="/checkin-ios/icon.png" />
  <title>CheckOut iOS Onboarding</title>
  <style>
body {
    font-family: "Inter", sans-serif;
    color: #1d1d1d;
    font-size: 19px;
    background: #0D1116;
    display: block;
    margin: 8px;
}
.mainContent {
    display: block;
    position: relative;
    text-align: center;
    max-width: 400px;
    margin: 0 auto;
    padding: 20px;
    background-color: var(--form-bg-color);
    color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    transition: background-color 0.5s;
}
.headerWelcome {
    text-align: center;
    font-size: 1.4em;
}
.headerDiv {
    margin-top: 10px;
    margin-bottom: 5px;
    text-align: center;
}
.topIcon {
    float: right;text-align: center;vertical-align: middle;
}
.setup-form {
  margin-bottom: 30px;
}

input[type="text"],
select {
  width: 70%;
  padding: 10px;
  margin-bottom: 10px;
  border: 1px solid #cccccc94;
  border-radius: 5px;
  background-color: #3B3B3B;
}

button {
  font-size: 19px;
  width: 70%;
  padding: 10px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.next-button {
  width: 70%;
  padding: 10px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  text-decoration: none;
}

button:hover {
  background-color: #0056b3;
}
.footerText,.footerText:visited,.footerText:active {
    font-size: 10px;
    text-align: right;
    margin-bottom: 8px;
    color: #AFAFAF;
    text-decoration: none;
}
.termsText {
    font-size: 11px;
    text-align: left;
    margin-bottom: 8px;
    color: #AFAFAF;
    text-decoration: none;
}
.footerTextLink, .footerTextLink:active, .footerTextLink:visited {
    font-size: 15px;
}
.footerTextLink:hover {
    color: #ffffff;
    text-decoration: underline;
}
.tosLink, .tosLink:visited, .tosLink:active {
    color: #58A6FF;
    text-decoration: none;
}
.tosLink:hover {
    color: #58A6FF;
    text-decoration: underline;
}
.select2 {
    width: 100%;
    padding: 1px;
    margin-bottom: 10px;
    border: 1px solid #cccccc94;
    border-radius: 5px;
    background-color: #3B3B3B;
    color: white; /* Text color */
}
.select2-selection__rendered {
    font-size: 14px;
}
.hidden {
  display: none;
}

#overlay {
  display: none;
  position: absolute; /* Changed from fixed to absolute */
  top: 0;
  left: 0;
  right: 0; /* Ensure it spans the entire form area */
  bottom: 0;
  background: rgba(255, 255, 255, 0.7);
  z-index: 1000;
}

.loader {
  border: 5px solid #f3f3f3;
  border-top: 5px solid #3498db;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 2s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  margin: -25px 0 0 -25px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
  </style>
  </head>
<body>
<div class="mainContent">
    <div id="overlay" class="hidden">
        <div class="loader"></div>
    </div>
    <div class="headerDiv">
<img class="topIcon" src="data:image/webp;base64,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" height="35px" alt=""><br>
<h3 class="headerWelcome">Welcome to CheckOut </h3>
    <p style="white-space: pre-line" id="action-text1">Let's setup your CheckOut app.

    </p>
    <p id="action-text">Select institution:</p>
</div>
<div class="setup-form">
    <select id="selectionBox"></select> <!-- Updated select box -->
    <button id="nextButton">Next</button>
</div>
<div style="display: flex; justify-content: space-between;">
<p id="termsText" class="termsText" hidden>Clicking&nbsp;<b>Next</b>&nbsp;means that you agree with CheckOut's&nbsp;<a class="tosLink" href="https://rejectdopamine.com/terms">Terms of Service</a>&nbsp;and acknowledge CheckOut's&nbsp;<a class="tosLink" href="https://rejectdopamine.com/terms#privacy">privacy and cookies policy</a>.</p>
  <p id="versionText" class="footerText" hidden >v2.4.iOS<br><a id="startAgain" class="footerText footerTextLink" href="javascript:location.reload()"></a></p>
</div>
</div>
<script><%- include('../views/jquery'); %></script>
<script><%- include('../views/select2'); %></script>

<script>
   
//document.getElementById('overlay').style.display = 'block';
$(document).ready(function() {
    // Initialize Select2 with empty data initially
    $('#selectionBox').select2({
        data: [],
        minimumResultsForSearch: Infinity // Disable search box
    });

    // Function to fetch years for the selected institution
    function fetchYears(institutionId) {
        document.getElementById("action-text").innerText = "Select year of study:";
        $.ajax({
            url: '/checkin-ios/api/app/find/' + institutionId + '/yr',
            dataType: 'json',
            success: function(data) {
                if (data.years.length === 0) {
                    // No results found
                    $('#nextButton').remove();
                    $('.setup-form').remove();
                    document.getElementById("action-text1").innerHTML = "<br>University not registered. ❌<br><br><small>Please get in contact via the link below if you would like to use CheckOut at your university.</small>";
                    document.getElementById("action-text").innerText = "";
                    var buttonContainer = $('<div>', {
                        class: 'button-container'
                    }).insertAfter('#action-text');
                    $('<br>').appendTo(buttonContainer);
                    var button1 = $('<a>', {
                        text: 'FAQ & Contact',
                        class: 'next-button',
                        href: 'https://rejectdopamine.com/faq',
                        target: '_parent'
                    }).appendTo(buttonContainer);
                    return; // Stop further execution
                }

                var yearOptions = $.map(data.years, function(year) {
                    return {
                        id: year,
                        text: year.toString()
                    };
                });

                // Update the Select2 dropdown with the fetched years
                $('#selectionBox').empty().select2({
                    data: yearOptions,
                    minimumResultsForSearch: Infinity,
                    minimumInputLength: 0, // Require user input to select an item
                }).val(null).trigger('change');

                // Set the placeholder dynamically
                $('#select2-selectionBox-container').text('');

                setTimeout(function() {
                    // Trigger the 'select2:open' event to open the search
                    $('.select2-selection__arrow').trigger('click');
                }, 1);

                setTimeout(function() {
                    var inputField = document.querySelector('.select2-search__field');
                    if (inputField) {
                        inputField.focus();
                    }
                }, 50);
            },
            error: function() {
                console.error('Error fetching years for institution: ' + institutionId);
            }
        });
    }


    // Function to fetch courses for the selected institution and year
    function fetchCourses(institutionId, year) {
        document.getElementById("action-text").innerText = "Select your course:";
        $.ajax({
            url: '/checkin-ios/api/app/find/' + institutionId + '/' + year + '/crs',
            dataType: 'json',
            success: function(data) {
                if (data.courses.length === 0) {
                    // No results found
                    $('#nextButton').remove();
                    $('.setup-form').remove();
                    document.getElementById("action-text1").innerHTML = "<br>No courses registered. ❌<br><br><small>Please get in via the link in settings if you would like to use CheckOut for your course.</small>";
                    document.getElementById("action-text").innerText = "";
                    // var buttonContainer = $('<div>', {
                    //     class: 'button-container'
                    // }).insertAfter('#action-text');
                    // $('<br>').appendTo(buttonContainer);
                    // var button1 = $('<a>', {
                    //     text: 'FAQ & Contact',
                    //     class: 'next-button',
                    //     href: '/faq',
                    //     target: '_parent'
                    // }).appendTo(buttonContainer);
                return; // Stop further execution
                }
                var courseOptions = $.map(data.courses, function(course) {
                    return {
                        id: course.course_code,
                        text: course.course_name
                    };
                });

                // Update the Select2 dropdown with the fetched courses
                $('#selectionBox').empty().select2({
                    data: courseOptions,
                    selectOnClose: false,
                    minimumInputLength: 0 // Require user input to select an item
                }).val(null).trigger('change');

                /// Set the placeholder dynamically
                $('#select2-selectionBox-container').text('');

                setTimeout(function() {
                    // Trigger the 'select2:open' event to open the search
                    $('.select2-selection__arrow').trigger('click');
                }, 1);
                setTimeout(function() {
                var inputField = document.querySelector('.select2-search__field');
                if (inputField) {
                    inputField.focus();
                    inputField.setAttribute('placeholder', 'Search courses..');
                }
            }, 50);
            },
            error: function() {
                console.error('Error fetching courses for institution: ' + institutionId + ' and year: ' + year);
            }
        });
    }

    // Fetch the list of university names and populate the Select2 dropdown
    var instData = <%- JSON.stringify(instData) %>; // Parse JSON object
    $(document).ready(function() {
        var universityNames = $.map(instData, function(item) {
            return {
                id: item.institution_id,
                text: item.name
            };
        });

        // Initialize Select2 with the data and prevent automatic selection
        $('#selectionBox').empty().select2({
            data: universityNames,
            selectOnClose: false,
            minimumInputLength: 0 // Require user input to select an item
        }).val(null).trigger('change');

        // Set the placeholder dynamically
        $('#select2-selectionBox-container').text('');

        $('.select2-selection__arrow').trigger('click');
            var inputField = document.querySelector('.select2-search__field');
            if (inputField) {
                inputField.focus();
                inputField.setAttribute('placeholder', 'Search universities..');
            }

        // Open Select2 dropdown on click
        $(document).on('click', '.select2', function() {
            var select = $(this).siblings('select');
            select.select2('open'); // Open the Select2 dropdown
        });
        //document.getElementById('overlay').style.display = 'none';
        
        // Create a MutationObserver to watch for changes in the span
        var observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    // Check if the span's content is not empty
                    if ($('#select2-selectionBox-container').text().trim() !== '') {
                        $('#termsText').show();
                        $('#versionText').show();
                    }
                });
            });

            // Configuration of the MutationObserver
            var config = { childList: true, subtree: true };

            // Start observing the target node for configured mutations
            observer.observe(document.getElementById('select2-selectionBox-container'), config);
    });


    $(document).on('click', '.select2', function() {
        var select = $(this).siblings('select');
        select.select2('open'); // Open the Select2 dropdown
    });

    // Add event listener for the next button
    $('#nextButton').on('click', function() {
        var selectedValue = $('#selectionBox').val();
        if (selectedValue) {
            // Check if this is the first or second step
            if ($('#nextButton').text() === 'Next') {
                // Store the institution ID in local storage
                localStorage.setItem('inst', selectedValue);
                window.webkit.messageHandlers.saveInst.postMessage(selectedValue)
                document.getElementById("startAgain").innerText = "Start Again";
                document.getElementById("termsText").innerText = "";
                // Fetch years for the selected institution
                fetchYears(selectedValue);
                // Update button text for the next step
                $('#nextButton').text('Select Course');
            } else if ($('#nextButton').text() === 'Select Course') {
                // Retrieve the stored institution ID from local storage
                var institutionID = localStorage.getItem('inst');

                // Fetch courses for the selected institution and year
                var selectedYear = $('#selectionBox').val();
                localStorage.setItem('yr', selectedYear);
                window.webkit.messageHandlers.saveYr.postMessage(selectedYear)
                fetchCourses(institutionID, selectedYear);
                // Update button text for the final step
                $('#nextButton').text('Finish');
            } else {
                var selectedCourse = $('#selectionBox').val();
                localStorage.setItem('crs', selectedCourse);
                window.webkit.messageHandlers.saveCrs.postMessage(selectedCourse)
                var setupStatus = "1"
                window.webkit.messageHandlers.setupStatus.postMessage(setupStatus)
                document.getElementById("action-text1").innerHTML = "<br>Setup complete! ✅<br><br><small>This screen should now close.</small>";
                document.getElementById("action-text").innerText = "";
                $('#nextButton').remove();
                $('.setup-form').remove();
                // // Create a div to contain the buttons
                // var buttonContainer = $('<div>', {
                //     class: 'button-container'
                // }).insertAfter('#action-text');
                // $('<br>').appendTo(buttonContainer);

                // // Create the first button
                // var button1 = $('<a>', {
                //     text: 'Submit and View codes',
                //     class: 'next-button',
                //     href: '/',
                //     target: '_parent'
                // }).appendTo(buttonContainer);

                // Add some spacing between buttons
                $('<br><br><br>').appendTo(buttonContainer);

                // // Create the second button
                // var button2 = $('<a>', {
                //     text: 'View Codes',
                //     class: 'next-button',
                //     href: '/',
                //     target: '_parent'
                // }).appendTo(buttonContainer);
                // $('<br><br><br>').appendTo(buttonContainer);
            }
        } else {
            alert('Please select an option from the list.');
        }
    });
});

// Listen for the keydown event on the document
document.addEventListener('keydown', function(event) {
    // Check if the Tab key is pressed
    if (event.key === 'Tab') {
        // Prevent the default Tab behavior
        event.preventDefault();

        // Simulate clicking on the select2 span
        const select2Span = document.querySelector('.select2-selection');
        if (select2Span) {
            select2Span.click();

            // Add a delay before selecting the first option
            setTimeout(function() {
                // Get the first item in the search results dropdown
                const firstResult = document.querySelector('.select2-results__option');

                // Check if a result is found
                if (firstResult) {
                    // Simulate a click on the first result to select it
                    firstResult.click();
                }
            }, 200); // Adjust the delay time as needed
        }
    }
});

</script>
</body></html>